(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{15:function(e,t,s){},17:function(e,t,s){},18:function(e,t,s){"use strict";s.r(t);var c=s(8),a=s.n(c),n=s(2),i=s(1),o=s.n(i),r=(s(13),s(14),s(15),s(3)),l=s.n(r),d=s(0),j=o.a.createContext({commentList:void 0,setCommentList:function(){},commentListError:!1,setCommentListError:function(){}}),m=function(e){var t=e.children,s=Object(i.useState)(void 0),c=Object(n.a)(s,2),a=c[0],o=c[1],r=Object(i.useState)(!1),l=Object(n.a)(r,2),m={commentList:a,setCommentList:o,commentListError:l[0],setCommentListError:l[1]};return Object(d.jsx)(j.Provider,{value:m,children:t})},b="https://mate.academy/students-api";function u(e){return new Promise((function(t){setTimeout(t,e)}))}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return s&&(c.body=JSON.stringify(s),c.headers={"Content-Type":"application/json; charset=UTF-8"}),u(300).then((function(){return fetch(b+e,c)})).then((function(e){return e.json()}))}var O=function(e){return h(e)},x=function(e,t){return h(e,"POST",t)},f=function(e){return h(e,"DELETE")},p=function(e){var t=e.postList,s=e.setSelectedPost,c=e.selectedPost,a=e.setOpenForm,n=Object(i.useContext)(j),o=n.setCommentList,r=n.setCommentListError;return Object(d.jsxs)("div",{"data-cy":"PostsList",children:[Object(d.jsx)("p",{className:"title",children:"Posts:"}),Object(d.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{className:"has-background-link-light",children:[Object(d.jsx)("th",{children:"#"}),Object(d.jsx)("th",{children:"Title"}),Object(d.jsx)("th",{children:" "})]})}),Object(d.jsx)("tbody",{children:t&&t.map((function(e){var t=e.id,n=e.title;return Object(d.jsxs)("tr",{"data-cy":"Post",children:[Object(d.jsx)("td",{"data-cy":"PostId",children:t}),Object(d.jsx)("td",{"data-cy":"PostTitle",children:n}),Object(d.jsx)("td",{className:"has-text-right is-vcentered",children:Object(d.jsx)("button",{type:"button","data-cy":"PostButton",className:l()("button","is-link",{"is-light":!(c&&c.id===t)}),onClick:function(){var n;(s(e),a(!1),c&&c.id===t)?s(null):(o(void 0),(n=t,O("/comments?postId=".concat(n))).then((function(e){o(e),r(!1)})).catch((function(){o([]),r(!0)})))},children:c&&c.id===t?"Close":"Open"})})]},t)}))})]})]})},N=s(6),v=(s(17),function(){return Object(d.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(d.jsx)("div",{className:"Loader__content"})})}),y=function(e){var t=e.selectedPost,s=Object(i.useContext)(j),c=s.commentList,a=s.setCommentList,o=s.setCommentListError,r=Object(i.useState)(""),m=Object(n.a)(r,2),b=m[0],u=m[1],h=Object(i.useState)(""),O=Object(n.a)(h,2),f=O[0],p=O[1],v=Object(i.useState)(""),y=Object(n.a)(v,2),g=y[0],C=y[1],S=Object(i.useState)(!1),L=Object(n.a)(S,2),E=L[0],P=L[1],k=Object(i.useState)(!1),w=Object(n.a)(k,2),F=w[0],T=w[1],D=Object(i.useState)(!1),I=Object(n.a)(D,2),M=I[0],B=I[1],U=Object(i.useCallback)((function(){u(""),p(""),C("")}),[]),A=function(){if(b||P(!0),f||T(!0),g||B(!0),b&&f&&g){var e={id:Math.floor(1e6*Math.random()),postId:t.id,name:b,email:f,body:g};(s=e,x("/comments",s)).then((function(){c&&(o(!1),a([].concat(Object(N.a)(c),[e])),U())})).catch((function(){o(!0),U()}))}var s},_=Object(i.useCallback)((function(e){"Enter"===e.code&&(e.preventDefault(),A())}),[b,f,g]),J=Object(i.useCallback)((function(e){e.preventDefault(),A()}),[b,f,g]);return Object(d.jsxs)("form",{"data-cy":"NewCommentForm",children:[Object(d.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:"Name Surname",className:l()("input",{"is-danger":E}),value:b,onChange:function(e){u(e.target.value),P(!1)},onKeyDown:_}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-user"})}),E&&Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),E&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",className:l()("input",{"is-danger":F}),value:f,onChange:function(e){p(e.target.value)},onKeyDown:_}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-envelope"})}),F&&Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),F&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",className:l()("input",{"is-danger":M}),value:g,onChange:function(e){C(e.target.value)},onKeyDown:_})}),M&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(d.jsxs)("div",{className:"field is-grouped",children:[Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"submit",className:l()("button","is-link",{"is-loading":!1}),onClick:J,children:"Add"})}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:U,children:"Clear"})})]})]})},g=function(e){var t=e.selectedPost,s=e.openForm,c=e.setOpenForm,a=t.id,n=t.title,o=t.body,r=Object(i.useContext)(j),m=r.commentList,b=r.setCommentList,u=r.commentListError,h=r.setCommentListError;return Object(d.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(d.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(d.jsxs)("div",{className:"block",children:[Object(d.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(a,": ").concat(n)}),Object(d.jsx)("p",{"data-cy":"PostBody",children:o})]}),Object(d.jsx)("div",{className:"block",children:!m&&Object(d.jsx)(v,{})||!u&&Object(d.jsxs)(d.Fragment,{children:[m&&m.length>0?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("p",{className:"title is-4",children:"Comments:"}),null===m||void 0===m?void 0:m.map((function(e){var t=e.name,s=e.email;return Object(d.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(d.jsxs)("div",{className:"message-header",children:[Object(d.jsx)("a",{href:"mailto:".concat(s),"data-cy":"CommentAuthor",children:t}),Object(d.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){(function(e){return f("/comments/".concat(e))})(e.id).then((function(){b(Object(N.a)(m.filter((function(t){return t.id!==e.id}))))})).catch((function(){h(!0)}))},children:"delete button"})]}),Object(d.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)}))]}):Object(d.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),Object(d.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:l()("button","is-link",{"is-hidden":s}),onClick:function(){c(!0)},children:"Write a comment"})]})||Object(d.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"})}),s&&Object(d.jsx)(y,{selectedPost:t})]})})},C=function(e){var t=e.setPostList,s=e.setUserSelect,c=e.userSelect,a=e.setPostListError,o=e.setOpenForm,r=Object(i.useState)([]),j=Object(n.a)(r,2),m=j[0],b=j[1],u=Object(i.useState)(!1),h=Object(n.a)(u,2),x=h[0],f=h[1];return Object(i.useEffect)((function(){O("/users").then((function(e){b(e)}))}),[]),Object(d.jsxs)("div",{"data-cy":"UserSelector",className:"dropdown is-active",children:[Object(d.jsx)("div",{className:"dropdown-trigger",children:Object(d.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){f(!x)},children:[Object(d.jsx)("span",{children:c?c.name:"Choose a user"}),Object(d.jsx)("span",{className:"icon is-small",children:Object(d.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(d.jsx)("div",{className:l()("dropdown-menu",{"is-hidden":!x}),id:"dropdown-menu",role:"menu",children:Object(d.jsx)("div",{className:"dropdown-content",children:m.map((function(e){var n=e.id,i=e.name;return Object(d.jsx)("a",{href:"#user-".concat(n),className:"dropdown-item",onClick:function(){var i;(f(!1),c&&c.id===n)||(s(e),t(void 0),(i=n,O("/posts?userId=".concat(i))).then((function(e){t(e),a(!1)})).catch((function(){o(!1),t([]),a(!0)})))},children:i},n)}))})})]})},S=function(){var e=Object(i.useState)(void 0),t=Object(n.a)(e,2),s=t[0],c=t[1],a=Object(i.useState)(null),o=Object(n.a)(a,2),r=o[0],j=o[1],b=Object(i.useState)(null),u=Object(n.a)(b,2),h=u[0],O=u[1],x=Object(i.useState)(!1),f=Object(n.a)(x,2),N=f[0],y=f[1],S=Object(i.useState)(!1),L=Object(n.a)(S,2),E=L[0],P=L[1];return Object(d.jsx)(m,{children:Object(d.jsx)("main",{className:"section",children:Object(d.jsx)("div",{className:"container",children:Object(d.jsxs)("div",{className:"tile is-ancestor",children:[Object(d.jsx)("div",{className:"tile is-parent",children:Object(d.jsxs)("div",{className:"tile is-child box is-success",children:[Object(d.jsx)("div",{className:"block",children:Object(d.jsx)(C,{setPostList:c,setUserSelect:j,userSelect:r,setPostListError:P,setOpenForm:y})}),Object(d.jsx)("div",{className:"block","data-cy":"MainContent",children:r?!s&&Object(d.jsx)(v,{})||s&&0!==s.length&&Object(d.jsx)(p,{postList:s,selectedPost:h,setSelectedPost:O,setOpenForm:y})||(E?Object(d.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}):Object(d.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"})):Object(d.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"})})]})}),h&&Object(d.jsx)("div",{"data-cy":"Sidebar",className:l()("tile","is-parent","is-8-desktop","Sidebar","Sidebar--open"),children:Object(d.jsx)("div",{className:"tile is-child box is-success ",children:Object(d.jsx)(g,{selectedPost:h,openForm:N,setOpenForm:y})})})]})})})})};a.a.render(Object(d.jsx)(S,{}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.ff4e24ac.chunk.js.map